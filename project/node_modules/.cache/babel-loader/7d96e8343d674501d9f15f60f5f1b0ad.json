{"ast":null,"code":"import _defineProperty from\"D:/frontend/\\u041A\\u0443\\u0440\\u0441\\u044B \\u0444\\u0440\\u043E\\u043D\\u0442\\u0435\\u043D\\u0434/274941-what-to-watch-10/project/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";var _StatusCodeMapping;import axios from'axios';import{StatusCodes}from'http-status-codes';import{BACKEND_URL,REQUEST_TIMEOUT}from'../const';import{getToken}from'./token';import{toast}from'react-toastify';var StatusCodeMapping=(_StatusCodeMapping={},_defineProperty(_StatusCodeMapping,StatusCodes.BAD_REQUEST,true),_defineProperty(_StatusCodeMapping,StatusCodes.UNAUTHORIZED,true),_defineProperty(_StatusCodeMapping,StatusCodes.NOT_FOUND,true),_StatusCodeMapping);var shouldDisplayError=function shouldDisplayError(response){return!!StatusCodeMapping[response.status];};export var createAPI=function createAPI(){var api=axios.create({baseURL:BACKEND_URL,timeout:REQUEST_TIMEOUT});api.interceptors.request.use(function(config){var token=getToken();if(token){config.headers['x-token']=token;}return config;});api.interceptors.response.use(function(response){return response;},function(error){if(error.response&&shouldDisplayError(error.response)){toast.warn(error.response.data.error);}throw error;});return api;};","map":{"version":3,"names":["axios","StatusCodes","BACKEND_URL","REQUEST_TIMEOUT","getToken","toast","StatusCodeMapping","BAD_REQUEST","UNAUTHORIZED","NOT_FOUND","shouldDisplayError","response","status","createAPI","api","create","baseURL","timeout","interceptors","request","use","config","token","headers","error","warn","data"],"sources":["D:/frontend/Курсы фронтенд/274941-what-to-watch-10/project/src/services/api.ts"],"sourcesContent":["import axios, { AxiosError, AxiosInstance, AxiosRequestConfig, AxiosResponse } from 'axios';\nimport { StatusCodes } from 'http-status-codes';\nimport { BACKEND_URL, REQUEST_TIMEOUT } from '../const';\nimport { getToken } from './token';\nimport {toast} from 'react-toastify';\n\nconst StatusCodeMapping: Record<number, boolean> = {\n  [StatusCodes.BAD_REQUEST]: true,\n  [StatusCodes.UNAUTHORIZED]: true,\n  [StatusCodes.NOT_FOUND]: true\n};\n\nconst shouldDisplayError = (response: AxiosResponse) => !!StatusCodeMapping[response.status];\n\nexport const createAPI = (): AxiosInstance => {\n  const api = axios.create({\n    baseURL: BACKEND_URL,\n    timeout: REQUEST_TIMEOUT,\n  });\n\n  api.interceptors.request.use(\n    (config: AxiosRequestConfig) => {\n      const token = getToken();\n\n      if (token) {\n        config.headers['x-token'] = token;\n      }\n\n      return config;\n    },\n  );\n\n  api.interceptors.response.use(\n    (response) => response,\n    (error: AxiosError) => {\n      if (error.response && shouldDisplayError(error.response)) {\n        toast.warn(error.response.data.error);\n      }\n\n      throw error;\n    }\n  );\n\n  return api;\n};\n"],"mappings":"0OAAA,MAAOA,MAAP,KAAoF,OAApF,CACA,OAASC,WAAT,KAA4B,mBAA5B,CACA,OAASC,WAAT,CAAsBC,eAAtB,KAA6C,UAA7C,CACA,OAASC,QAAT,KAAyB,SAAzB,CACA,OAAQC,KAAR,KAAoB,gBAApB,CAEA,GAAMC,kBAA0C,2DAC7CL,WAAW,CAACM,WADiC,CACnB,IADmB,qCAE7CN,WAAW,CAACO,YAFiC,CAElB,IAFkB,qCAG7CP,WAAW,CAACQ,SAHiC,CAGrB,IAHqB,qBAAhD,CAMA,GAAMC,mBAAkB,CAAG,QAArBA,mBAAqB,CAACC,QAAD,QAA6B,CAAC,CAACL,iBAAiB,CAACK,QAAQ,CAACC,MAAV,CAAhD,EAA3B,CAEA,MAAO,IAAMC,UAAS,CAAG,QAAZA,UAAY,EAAqB,CAC5C,GAAMC,IAAG,CAAGd,KAAK,CAACe,MAAN,CAAa,CACvBC,OAAO,CAAEd,WADc,CAEvBe,OAAO,CAAEd,eAFc,CAAb,CAAZ,CAKAW,GAAG,CAACI,YAAJ,CAAiBC,OAAjB,CAAyBC,GAAzB,CACE,SAACC,MAAD,CAAgC,CAC9B,GAAMC,MAAK,CAAGlB,QAAQ,EAAtB,CAEA,GAAIkB,KAAJ,CAAW,CACTD,MAAM,CAACE,OAAP,CAAe,SAAf,EAA4BD,KAA5B,CACD,CAED,MAAOD,OAAP,CACD,CATH,EAYAP,GAAG,CAACI,YAAJ,CAAiBP,QAAjB,CAA0BS,GAA1B,CACE,SAACT,QAAD,QAAcA,SAAd,EADF,CAEE,SAACa,KAAD,CAAuB,CACrB,GAAIA,KAAK,CAACb,QAAN,EAAkBD,kBAAkB,CAACc,KAAK,CAACb,QAAP,CAAxC,CAA0D,CACxDN,KAAK,CAACoB,IAAN,CAAWD,KAAK,CAACb,QAAN,CAAee,IAAf,CAAoBF,KAA/B,EACD,CAED,KAAMA,MAAN,CACD,CARH,EAWA,MAAOV,IAAP,CACD,CA9BM"},"metadata":{},"sourceType":"module"}