{"ast":null,"code":"import _slicedToArray from\"D:/frontend/\\u041A\\u0443\\u0440\\u0441\\u044B \\u0444\\u0440\\u043E\\u043D\\u0442\\u0435\\u043D\\u0434/274941-what-to-watch-10/project/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{useEffect,useRef,useState}from'react';import{useNavigate,useParams}from'react-router-dom';import{AppRoute}from'../../const';import{useAppDispatch,useAppSelector}from'../../hooks';import{redirectToRoute}from'../../store/action';import{fetchLoadFilmAction}from'../../store/api-actions';import{getFilm}from'../../store/data-loading/selector';import{getFilmFoundStatus}from'../../store/film-screening/selector';import{getFilmTime}from'../../utils';import LoadingScreen from'../loading-screen/loading-screen';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function Player(){var _useParams=useParams(),id=_useParams.id;var navigate=useNavigate();var dispatch=useAppDispatch();var film=useAppSelector(getFilm);var isFilmNotFound=useAppSelector(getFilmFoundStatus);var videoRef=useRef(null);var video=videoRef.current;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),isLoading=_useState2[0],setIsLoading=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),isPlaying=_useState4[0],setIsPlaying=_useState4[1];var _useState5=useState(0),_useState6=_slicedToArray(_useState5,2),togglerPos=_useState6[0],setTogglerPos=_useState6[1];useEffect(function(){dispatch(fetchLoadFilmAction(id));},[dispatch,id]);useEffect(function(){if(videoRef.current===null){return;}var updateTogglerPos=function updateTogglerPos(){var _videoRef$current;if(videoRef.current!==null&&!isNaN(videoRef.current.duration)){setTogglerPos(videoRef.current.currentTime/videoRef.current.duration*100);}if((_videoRef$current=videoRef.current)!==null&&_videoRef$current!==void 0&&_videoRef$current.ended){setIsPlaying(false);}};var addIsLoading=function addIsLoading(){return setIsLoading(true);};var removeIsLoading=function removeIsLoading(){return setIsLoading(false);};videoRef.current.addEventListener('timeupdate',updateTogglerPos);videoRef.current.addEventListener('loadstart',addIsLoading);videoRef.current.addEventListener('canplay',removeIsLoading);if(isPlaying){videoRef.current.pause();videoRef.current.muted=false;return;}videoRef.current.play();return function(){if(video===null){return;}video.addEventListener('timeupdate',updateTogglerPos);video.addEventListener('loadstart',addIsLoading);video.addEventListener('canplay',removeIsLoading);};},[video,isPlaying,film]);if(isFilmNotFound){dispatch(redirectToRoute(AppRoute.NotFound));}if(!film){return/*#__PURE__*/_jsx(LoadingScreen,{});}return/*#__PURE__*/_jsxs(\"div\",{className:\"player\",children:[isLoading&&/*#__PURE__*/_jsx(LoadingScreen,{}),/*#__PURE__*/_jsx(\"video\",{src:film.videoLink,className:\"player__video\",poster:film.previewImage,ref:videoRef,muted:true}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"player__exit\",onClick:function onClick(){return navigate(\"/films/\".concat(id));},children:\"Exit\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"player__controls\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"player__controls-row\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"player__time\",children:[/*#__PURE__*/_jsx(\"progress\",{className:\"player__progress\",value:togglerPos,max:\"100\"}),/*#__PURE__*/_jsx(\"div\",{className:\"player__toggler\",style:{left:\"\".concat(togglerPos,\"%\")},children:\"Toggler\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"player__time-value\",children:[\"-\",video?getFilmTime(video.duration-video.currentTime):'00:00:00']})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"player__controls-row\",children:[/*#__PURE__*/_jsxs(\"button\",{type:\"button\",className:\"player__play\",onClick:function onClick(){return setIsPlaying(!isPlaying);},children:[isPlaying?/*#__PURE__*/_jsx(\"svg\",{viewBox:\"0 0 19 19\",width:\"19\",height:\"19\",children:/*#__PURE__*/_jsx(\"use\",{xlinkHref:\"#play-s\"})}):/*#__PURE__*/_jsx(\"svg\",{viewBox:\"0 0 14 21\",width:\"14\",height:\"21\",children:/*#__PURE__*/_jsx(\"use\",{xlinkHref:\"#pause\"})}),/*#__PURE__*/_jsx(\"span\",{children:isPlaying?'Pause':'Play'})]}),/*#__PURE__*/_jsx(\"div\",{className:\"player__name\",children:\"Transpotting\"}),/*#__PURE__*/_jsxs(\"button\",{type:\"button\",className:\"player__full-screen\",onClick:function onClick(){return video===null||video===void 0?void 0:video.requestFullscreen();},children:[/*#__PURE__*/_jsx(\"svg\",{viewBox:\"0 0 27 27\",width:\"27\",height:\"27\",children:/*#__PURE__*/_jsx(\"use\",{xlinkHref:\"#full-screen\"})}),/*#__PURE__*/_jsx(\"span\",{children:\"Full screen\"})]})]})]})]});}export default Player;","map":{"version":3,"names":["useEffect","useRef","useState","useNavigate","useParams","AppRoute","useAppDispatch","useAppSelector","redirectToRoute","fetchLoadFilmAction","getFilm","getFilmFoundStatus","getFilmTime","LoadingScreen","Player","id","navigate","dispatch","film","isFilmNotFound","videoRef","video","current","isLoading","setIsLoading","isPlaying","setIsPlaying","togglerPos","setTogglerPos","updateTogglerPos","isNaN","duration","currentTime","ended","addIsLoading","removeIsLoading","addEventListener","pause","muted","play","NotFound","videoLink","previewImage","left","requestFullscreen"],"sources":["D:/frontend/Курсы фронтенд/274941-what-to-watch-10/project/src/pages/player/player.tsx"],"sourcesContent":["import { useEffect, useRef, useState } from 'react';\nimport { useNavigate, useParams } from 'react-router-dom';\nimport { AppRoute } from '../../const';\nimport { useAppDispatch, useAppSelector } from '../../hooks';\nimport { redirectToRoute } from '../../store/action';\nimport { fetchLoadFilmAction } from '../../store/api-actions';\nimport { getFilm } from '../../store/data-loading/selector';\nimport { getFilmFoundStatus } from '../../store/film-screening/selector';\nimport { getFilmTime } from '../../utils';\nimport LoadingScreen from '../loading-screen/loading-screen';\n\n\nfunction Player(): JSX.Element | null {\n  const { id } = useParams();\n\n  const navigate = useNavigate();\n  const dispatch = useAppDispatch();\n\n  const film = useAppSelector(getFilm);\n  const isFilmNotFound = useAppSelector(getFilmFoundStatus);\n\n  const videoRef = useRef<HTMLVideoElement>(null);\n  const video = videoRef.current;\n\n  const [isLoading, setIsLoading] = useState(false);\n  const [isPlaying, setIsPlaying] = useState(false);\n  const [togglerPos, setTogglerPos] = useState(0);\n\n  useEffect(() => {\n    dispatch(fetchLoadFilmAction(id));\n  }, [dispatch, id]);\n\n  useEffect(() => {\n    if (videoRef.current === null) {\n      return;\n    }\n\n    const updateTogglerPos = () => {\n      if (videoRef.current !== null && !isNaN(videoRef.current.duration) ) {\n        setTogglerPos(videoRef.current.currentTime / videoRef.current.duration * 100);\n      }\n      if (videoRef.current?.ended) {\n        setIsPlaying(false);\n      }\n    };\n\n    const addIsLoading = () => setIsLoading(true);\n    const removeIsLoading = () => setIsLoading(false);\n\n    videoRef.current.addEventListener('timeupdate', updateTogglerPos);\n    videoRef.current.addEventListener('loadstart', addIsLoading);\n    videoRef.current.addEventListener('canplay', removeIsLoading);\n\n    if (isPlaying) {\n      videoRef.current.pause();\n      videoRef.current.muted = false;\n      return;\n    }\n\n    videoRef.current.play();\n\n    return () => {\n      if (video === null) { return; }\n      video.addEventListener('timeupdate', updateTogglerPos);\n      video.addEventListener('loadstart', addIsLoading);\n      video.addEventListener('canplay', removeIsLoading);\n    };\n\n  }, [video, isPlaying, film]);\n\n  if (isFilmNotFound) {\n    dispatch(redirectToRoute(AppRoute.NotFound));\n  }\n\n  if (!film) { return <LoadingScreen />; }\n\n  return (\n    <div className=\"player\">\n      {isLoading && <LoadingScreen />}\n      <video src={film.videoLink} className=\"player__video\"\n        poster={film.previewImage}\n        ref={videoRef}\n        muted\n      >\n      </video>\n      <button type=\"button\" className=\"player__exit\"\n        onClick={() => navigate(`/films/${id}`)}\n      >Exit\n      </button>\n      <div className=\"player__controls\">\n        <div className=\"player__controls-row\">\n          <div className=\"player__time\">\n            <progress className=\"player__progress\"\n              value={togglerPos}\n              max=\"100\"\n            >\n            </progress>\n            <div className=\"player__toggler\"\n              style={{ left: `${togglerPos}%` }}\n            >\n              Toggler\n            </div>\n          </div>\n          <div className=\"player__time-value\">-\n            {\n              video\n                ? getFilmTime(video.duration - video.currentTime)\n                : '00:00:00'\n            }\n          </div>\n        </div>\n        <div className=\"player__controls-row\">\n          <button type=\"button\" className=\"player__play\"\n            onClick={() => setIsPlaying(!isPlaying)}\n          >\n            {\n              isPlaying\n                ?\n                <svg viewBox=\"0 0 19 19\" width=\"19\" height=\"19\">\n                  <use xlinkHref=\"#play-s\"></use>\n                </svg>\n                :\n                <svg viewBox=\"0 0 14 21\" width=\"14\" height=\"21\">\n                  <use xlinkHref=\"#pause\"></use>\n                </svg>\n            }\n            <span>{isPlaying ? 'Pause' : 'Play'}</span>\n          </button>\n          <div className=\"player__name\">Transpotting</div>\n          <button type=\"button\" className=\"player__full-screen\"\n            onClick={() => video?.requestFullscreen()}\n          >\n            <svg viewBox=\"0 0 27 27\" width=\"27\" height=\"27\">\n              <use xlinkHref=\"#full-screen\"></use>\n            </svg>\n            <span>Full screen</span>\n          </button>\n        </div>\n      </div>\n    </div >\n  );\n}\n\nexport default Player;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}